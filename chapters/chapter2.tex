
\chapter{Canonical form}

%\input{chapters/conventions.tex}

\section{Ordered complex and canonical form}


\begin{definition}[$\R$-Filtered complex]
Let $\{C_k\}_{k=0}^{\infty}$ be a complex. 
A $\R$-filtration (sometimes we will simply say a filtration), on $\{C_k\}_{k=0}^{\infty}$ 
is an increasing sequence of real numbers, $\{r_i\}_{i=0}^n$
so that for each $r_i$ there as associated $F_{\leq r_i}C_k\subset C_k$ for every $k$
that satisfies:

$$
\{0\}\subset
F_{\leq r_0}C_k
\subset
F_{\leq r_k}C_k
\subset
\cdots
\subset
F_{\leq r_n}C_k
=
C_k
$$
\end{definition}

As we well see, there are a lot of natural circumstances on which a filtration might arise. For example, 
the singular chain comples of a CW-complex are naturally filtered by its skeleton.

There are more structures we can put on a complex:


\begin{definition}[Complex with ordered generators]

Let $\{C_k\}_{k=0}^{\infty}$ be a filtered chain complex, with some basis $\{\e{j}{i}\}$.
Then we say that $\{C_k\}_{k=0}^{\infty}$ has ordered generators if the 
generatros are ordered as such:
$\e{k}{i}<\e{l}{j}$ if  $k=l$ or if $k=l$ and $i<j$.

Notice we do not compare generators that live on different chain groups.
\end{definition}

\begin{remark}
A filtrated complex has a natural order on the generators compatible with the filtration.
%Furthermore, if this filtration increases the dimension of each chain group by dimension $1$ (or $0$) on
%each step, then there is natural correspondence between the filtration and the ordering.
\end{remark}


\begin{definition}[Canonical form]

Let $\{C_k\}_{k=0}^{\infty}$ be a chain complex, with some basis $\{\e{k}{i}\}$.
Then we say that $\{C_k\}_{k=0}^{\infty}$ is in canonical form if,

\begin{enumerate}
\item $\partial \e{k}{i}$
is either $0$ or another generator.

\item If $\partial \e{k}{i}=\partial \e{l}{i}$,
then $\e{k}{i}= \e{l}{i}$.
\end{enumerate}

\end{definition}

\begin{remark}
\label{canonicalformsplit}
An equivalent formulation of the canonical form is that we can find a basis $S$ 
of $\{C_k\}_{k=0}^{\infty}$ so that $S$
can be separated into: 
\begin{enumerate}
\item $S_H$: Generators of the homology of the complex.

\item $S_{\text{birth}}$: Births, that is, elements whose boundary is $0$, but get killed in homology by an element of higher degree.

\item $S_{\text{death}}$: Deaths, elements whose boundary is another generator. 

\item $\partial$ is a bijection between $S_{\text{death}}$ 
and $S_{\text{birth}}$.
\end{enumerate}

That is:

$$
S=S_{\text{birth}}\sqcup
S_{\text{death}}\sqcup
 S_H
$$ 
\end{remark}

\begin{theorem}
\cite{bar1994}
\label{canonicalform}
Every filtered chain complex can be reduced to 
one in canonical form by an upper-triangular change of basis
which preserves the filtration.

Furthermore, the canonical form is unique.
\end{theorem}

%\input{proof/canonicalform.tex}

%\begin{definition}[Equivalent complexes]
%
%Two filtered complexes,
%$\{
%C_*
%\}$
%y
%$\{
%D_*
%\}$
%
%are said to be equivalent if 
%there is an isomorphism 
%
%\end{definition}

Canonical form allows us to classify graded differential complexes.
In particular, by will say two complexes are equivalent if
there is a bijective chain map
preserving the filtration between the two complexes.
More precisely:

\begin{definition}[Equivalent complexes]
Let $C$ and $D$ be two filtered complex as such:

\begin{align*}
\{0\}
&\subset
F_{\leq r_0}C_k
\subset
F_{\leq r_k}C_k
\subset
\cdots
\subset
F_{\leq r_n}C_k
=
C_k
\\
\{0\}
&\subset
F_{\leq r_0}D_k
\subset
F_{\leq r_k}D_k
\subset
\cdots
\subset
F_{\leq r_n}D_k
=
D_k
\end{align*}

Then we say that they are equivalent if and only if
there is chain map $f:C \to D$ so that
$$
f\left(
F_{\leq r_k}C_k
\right)
\subset
F_{\leq r_k}D_k, \quad\forall k,r_k
$$

\end{definition}

\begin{corollary}
Two filtered complexes are equivalent
\ifff they have the same canonical form.
\end{corollary}


\begin{corollary}{Category of filtered complexes is semi-simple.}
That is, any filtered complex, (or one with an ordered basis) can be expressed as a direct sum of 
1 dimensional complexes with trivial differential and 2 dimensional complexes with trivial homology.
\end{corollary}

\begin{prof}
Because any complex can we brought to canonical form, we can find a basis of the complex in the form of Remark \ref{canonicalformsplit}.
Then $\text{Span}(S_H)$ splits as a sum of 1 dimensional complexes with trivial differential, since the differential is trivial on $S_H$.
Similarly, the birth and death pairs splits into 2 dimensional complexes with one generator killing the other in homology.

\end{prof}


\section{Persistence complexes}

\begin{definition}[Persistent complex]
A persistence complex is a sequence of vector spaces 
$\{V_i\}_{0\leq i \leq n}$ and homomorphisms
 $f_i:V_i\to V_{i+1}$. That is, a diagram
as follows:


$$
\begin{tikzcd}
V_0 \arrow[r,"f_0"]
& V_1 \arrow[r]
& \cdots\arrow[r,"f_{n-1}"]
& V_n
\end{tikzcd}
$$


We denote $f_i^j
=
f_j\circ\cdots f_{i+1}\circ f_i
$ whith $i<j$.
Persistence diagrams may be of arbitrary cardinal,
as long as the indexed is set is well-ordered.

But we shall only considered them when they are finite or countable.

We further define it's graded Betti number as:

$$
b_i^j
=\left\{
\begin{array}{l c c}
\dim(V_i) & \text{if} & i=j\\
\text{rank}(f_i^j) & \text{if} & i<j\\
0 & \text{if} & i>j\\
\end{array}
\right.
$$

\end{definition}

It is worth mentioning that we usually consider the maps $f_i$
as inclusions and the spaces $V_i$ as chain groups. As such, we
can sometimes drop the vector space assumption and take 
modules over a PID. For example, it is common to consider $\mathbb{Z}$
instead of $\mathbb{K}$. We call this constructions
persistent modules. Precisely we define:

\begin{definition}(Persistence module)
A persistence complex is a sequence of modules
over a PID
$\{M_i\}_{0\leq i \leq n}$ and homomophisms $f_i:M_i\to M_{i+1}$. 
With the rest of the definitions as above.

\end{definition}

We give examples of useful persistence diagrams in \ref{examplespersistence}.

\begin{example}[Interval module]
We define the interval module for $i<j$
to be the module where all maps are either the trivial ones, 
being the identity whenever possible and the zero map otherwise and 
the $V_k$ to be:

$$
V_k
=
\left\{
\begin{array}{l l}
\mathbb{K} & \text{if } i\leq k\leq j\\
0 & \text{otherwise} 
\end{array}
\right.
$$


We denote it by $m(i,j)$
and we define it's associated interval to be $[i,j)$.

\end{example}



\begin{proposition}\cite{zomcar2002}
The category of countable persistence complex is equivalent to the one of graded modules over
$\mathbb{K}[t]$
\end{proposition}

\begin{proposition}\cite{zomcar2002}
Finite persistence diagrams are classified by 
their graded Betti numbers.

\end{proposition}

\begin{proposition}\cite{zomcar2002}
Every persistence module is the direct sum of interval modules.
Furthermore, the multiplicity of each interval module is an invariant
of the complex.

This intervals are called the persistence intervals of a given 
persistence module.
\end{proposition}

%\subsection{Canonical form=Persistence diagrams}

One important observation about the previous proposition,
is that a complex in canonical form gives a clear idea of what the persistence 
diagrams decomposition is. In particular, the beginning of a interval
indicates a birth and the end of an interval indicates a death. And
so, an element represent a non-trivial cohomology class if and only if
it belongs to an interval of the form $[\alpha,\infty)$

\subsection{Representations of the persistence complexes}

%\begin{definition}[Ranks diagrams]
%Given a persistence diagram, it's rank diagram
%is a subset of ${(x,y)\in[0,1]^2,x\leq y}$
%
%\end{definition}


%\begin{definition}[Persistence diagrams]
%
%\end{definition}

%\begin{definition}[Persistence diagrams]
%
%We call a persistence diagram to a finite family of half lines, indexed by $0,1,...$
%so that there is a discrete collection of points on each line and there are segments connecting points
%on a line of index $i$ to a line of index $i-1$.
%
%Furthermore, this segments always connect point of higher value with points of lower value.
%\end{definition}



%Usually we can represent persistence modules as diagrams,
%as is illustrated by the following example.
%We clarify this definition with an example:

Firstofall, we can represent canonical form as in the following example:



Clearly, from any complex in canonical form we can construct an associated persistent diagram by reversing the above process.
In the above example we ignored the filtration of the complex, but we consider that the diagram is filtered by height.
 Therefore:

%\begin{proposition}[Canonical form = Persistence diagrams]
%
%There is a natural equivalence between persistence diagrams and canonical forms.
%
%\end{proposition}


%Persistence diagrams are not the only way we can represent a canonical form. 
%Another important example are barcodes.

%\begin{definition}
%[barcodes]
%
%By codebar we will mean a representation of similar to one below,
%that a collection of bars, each one index (although index might be repeated),
%where finite bars represent births and deaths and infinite bars represent elements that generate the homology of the complex.
%\end{definition}


We have two natural ways to represent the persistent homology of a 
filtered complex, one is persistent barcodes and the other is persistent 

\begin{example}


%\begin{enumerate}
%
%
%\item To the line of index $k$ we assign
%it the complex $C_k$.
%
%\item Assign a generator to every point on every line a generator of $C_k$
%
%\item We define the differential operator $\partial$
%in the following way. If there is no segment coming out of the point, we define its differential to be zero.
%If two points are joined by a line, we define the differential of one as the other.
%
%\end{enumerate}

%For example, in this particular case the associated complex would be:

Consider the following complex:

\begin{enumerate}

\item $C_0 = \{\e{0}{0},\e{1}{0}\}$

\item $C_1 = \{\e{0}{1},\e{1}{1}\}$

\item $C_0 = \{\e{0}{2},\e{1}{2}\}$

\item $\partial \e{1}{1}=\e{0}{1}$, $\partial \e{0}{2}=\e{0}{1}$ and 
$0$ on the rest of the generators.
\end{enumerate}

And obviosuly $S_{\text{birth}}=\{
\e{0}{1},
\e{0}{1}
\}$,
$S_{\text{death}}=\{
\e{1}{1},
\e{0}{2}
\}$,
$
S_H=\{
\e{0}{0},
\e{1}{2}
\}
$
Then it's persistence diagram would be the following:

\begin{center}
\includegraphics[height=4cm, width=4cm]{persistence_diagram1.png}
\end{center}

And we have that it's persistence barcode would be:
%This example represents the barcode
%associated to the complex of the previous example.


\begin{center}
\includegraphics[height=4cm,width=7cm]{barcode1.png}
\end{center}


\end{example}






\subsection{Some important examples of persistent complexes}
\label{examplespersistence}

\begin{definition}[Discrete morse complex]
Let $f:M\to\mathbb{R}$ be a morse function from a compact manifold 
with finitely many critical points $t_0<\cdots<t_n$. Then the following diagram
is a persistence complex:

$$
\begin{tikzcd}
H^{dR}(f^{-1}(-\infty,t_0)) \arrow[r,"\subseteq"]
& H^{dR}(f^{-1}(-\infty,t_1)) \arrow[r,"\subseteq"]
& \cdots\arrow[r,"\subseteq"]
& H^{dR}(f^{-1}(-\infty,t_n))
\end{tikzcd}
$$

Where $H^{dR}$ is the de Rham complex and $\subseteq$
is homomorphism induced by the natural inclusion.

\end{definition}

\begin{definition}[{\Cech} Complex]

Let $X\subset \R^n$ be a discrete subset. Then, for $d>0$, we define the {\Cech}
complex of level $\epsilon$ as the following simplicial set:

%$$
%X_d 
%=
%\{
%x\in\R^n:
%d(x,X)\leq d
%\} 
%$$

$$
\tilde{C}_\epsilon(X)
=
\{
\sigma \subset X :
\bigcap_{y\in\sigma} B(y,\epsilon)\neq \emptyset
\}
$$

Then we define the {\Cech} complex at level $\varepsilon$ to be $\tilde{C}_\epsilon$.
%The {\Cech} complex is defined as $\{\tilde{C}_\epsilon\}_{\epsilon>0}$

\end{definition}


The {\Cech} has one key advantage,
it's homotopy type is easy to predict.
In particular, given a compact manifold $M$ of $\mathbb{R}$
we can pick a discrete subset $X$ and an appropiate $\varepsilon$
so that $\tilde C_\varepsilon(X)$ has the homotopy type of $M$.

This a consequence of the following theorem (and 
the equivalence between {\Cech} cohomology and De Rham
cohomology on manifolds).

\begin{theorem}
Let $X$ and $\varepsilon>0$, then $\tilde C_\varepsilon(X)$
is homotopy equivalent to the union of the $\varepsilon$-balls centered 
around the point of the complex. Explicitly:
$$
\tilde C_\varepsilon(X)
\quad
\overset{\text{h-eq}}
{{
=
\joinrel=
}}
\displaystyle\bigcup_{x \text{
vertex in 
}
\tilde C_\varepsilon(X)
}
B(x,\varepsilon)
$$
\end{theorem}


\begin{example}
\label{examplecech}
In the following example we illustrate the evolution of the {\Cech}
complex as $\varepsilon$ grows:

\begin{figure}[!htb]
\minipage{0.32\textwidth}
  \includegraphics[width=\linewidth]{imgs/cech_example_1_0_6.png}
  \caption*{
  {\Cech} complex for $\varepsilon<\frac{\sqrt{2}}{2}$
  }
  \label{fig:awesome_image1}
\endminipage\hfill
\minipage{0.32\textwidth}
  \includegraphics[width=\linewidth]{imgs/cech_example_1_0_8.png}
  \caption*{
  {\Cech} complex for $\frac{\sqrt{2}}{2}<\varepsilon<1$
  }
  \label{fig:awesome_image2}
\endminipage\hfill
\minipage{0.32\textwidth}%
  \includegraphics[width=\linewidth]{imgs/cech_example_1_1_2.png}
  \caption*{
  {\Cech} complex for $\varepsilon>1$
  }
  \label{fig:awesome_image3}
\endminipage
\end{figure}

\end{example}

%The {\Cech} has one key advantage, given a compact space, we
%can always choose $\varepsilon$ small enough and a
%natural toplogy so that the resulting {\Cech}
%complex is homotopy equivalent to the underlying space.
%
%\begin{theorem}[Nerve theorem]
%
%\end{theorem}



However, in practice the {\Cech} complex is very hard to calculate,
notice that as the dimension of $\mathbb{R}^n$ increases it would be necessary
to calculate the intersection of $n-1$-dimensional spheres, which is it a
computationally complex problem.

One solution to this is using the 
Vietoris-Rips complex.



\begin{definition}[Vietoris-Rips Complex]
Let $X\subset \R^n$ be a discrete subset. Then, for $d>0$, we define the \Cech
complex of level $\epsilon$ as the following simplicial set:

$$
VR_\epsilon(X)
=
\{
\sigma \subset X :
\text{diam}(\sigma)\leq \epsilon
\}
$$

\end{definition}

%The Vietoris-Rips complex is defined as $\{\tilde{R}_\epsilon\}_{\epsilon>0}$.
Then we define the Vietoris-Rips complex at level $\varepsilon$ to be 
$VR_\epsilon$.



%\begin{remark}
%Notice than if both the {\Cech} and Vietoris-Rips complex, the complex grows in a discrete manner meaning
%that there are only finitely many $\epsilon$ values for which the complex changes if $\epsilon$ is pertubed slightly.
%
%Furthermore, this complex are naturally filtrated and thus, they can be brought into canonical form.
%\end{remark}

There are many softwares that can be used to compute the
{\Cech} and Vietoris-Rips complexes, most of them rely on bringing the complex to canonical form.


The following example shows how the {\Cech}
and Vietories-Rips complex might differ:
(compare to example \ref{examplecech})

\begin{example}
\begin{figure}[!htb]
\minipage{0.24\textwidth}
  \includegraphics[width=\linewidth]{imgs/vr_example_1_0_6.png}
  \caption*{
  Vietoris-Rips complex for $\varepsilon<\frac{\sqrt{2}}{2}$
  }
  \label{fig:awesome_image1}
\endminipage\hfill
\minipage{0.24\textwidth}
  \includegraphics[width=\linewidth]{imgs/vr_example_1_0_8.png}
  \caption*{
  Vietoris-Rips complex for $\frac{\sqrt{2}}{2}<\varepsilon<1$
  }
  \label{fig:awesome_image2}
\endminipage\hfill
\minipage{0.24\textwidth}%
  \includegraphics[width=\linewidth]{imgs/vr_example_1_1_2.png}
  \caption*{
  Vietoris-Rips complex for $\varepsilon>1$
  }
  \label{fig:awesome_image3}
\endminipage
\minipage{0.24\textwidth}%
  \includegraphics[width=\linewidth]{imgs/vr_example_1_2_2.png}
  \caption*{
  Vietoris-Rips complex for $\varepsilon>2$
  }
  \label{fig:awesome_image3}
\endminipage
\end{figure}

\end{example}

Notice that we can combine the Vietoris-Rips (or {\Cech}) complex 
with an already existing filtration to give a bifiltrated complex:

\begin{definition}[Bifiltrated Vietoris-Rips complex]

Let $\mathcal{X}=(X,d,f)$ be an augmented metric space,
let $X_\sigma=f^{-1}(-\infty,\sigma]$ we define the bifiltrated
Vietoris-Rips complex as the complex
$\{{VR}_\epsilon^\sigma\}_{\epsilon>0,\sigma}$
with:

$$
{VR}_\epsilon^\sigma=
{VR}_\epsilon(X_\sigma)
$$

\end{definition}

\section{Comparison of the {\Cech} and Vietoris-Rips complex}

One great advantage of the {\Cech} complex is that it's homotopy type is highly predictable.
In particular, we have the classical {\Cech} nerve theorem:

This means we can always approximate the homology of a compact
manifold with the {\Cech} complex using a relatively low amount of points.
In the case of the Vietoris-Rips complex things are different.


However, there is a natural relation between these two complexes:

\begin{proposition}
The {\Cech} complex is always a subcomplex of the Rips complex. 
We also have a partial converse:
$VR_{\varepsilon/2}(X)$ is a subcomplex of $\tilde C_{\varepsilon}(X)$

More precisely:
$$
\tilde C_{\varepsilon/2}(X)
\hookrightarrow
VR_{\varepsilon/2}(X)
\hookrightarrow
\tilde C_{\varepsilon}(X)
\hookrightarrow
VR_{\varepsilon}(X)
$$
\end{proposition}


\section{Motivation}

%Another way in which filtered complexes arise is through Morse functions. 
%For example, let's 
%consider the following manifold with the morse function being the height function:

%\subsection{Arnold's extension problem}

%\chapter{Canonical form=Persistence diagrams}



%\section{Optimal sequence of metamorphoses of the canonical form}
%
%One natural question for quickly computing the canonical form of a complex is 
%the following: What is the shortest way to bring a complex to canonical form only using 
%relatively simple transformations.
%Now, what do we mean by simple transformations?
%
%\begin{definition}
%We say that a transformation of a complex is simple if it is one of the following:
%
%\begin{itemize}[label={}]
%
%\item {\bf Type (1)}: 
%A transformation sending $b$ to $b\pm a$
%
%\item {\bf Type (2)}:
%A transformation sending $b$ to $b\pm a$
%
%\end{itemize}
%
%
%\end{definition}


\section{Example of canonical form}

The proof of theorem \ref{canonicalform} gives an
algorithmic way to bring a complex into canonical form, 
we now expose how this methods works with an example. 
The general case should be clear afterwards.

\section{Augmented metric spaces}

\begin{definition}
Let $(X,d)$ be a metric space,
we say it is augmented if it comes equiped with a function 
$f:X\to\mathbb{R}$.

\end{definition}

We will say that an augmented metric space is injective if $f$ is.
And we will be interested in the case where $X$ is finite.

